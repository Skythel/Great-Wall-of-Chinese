<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta http-equiv="X-UA-Compatible" content="IE=edge">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Great Wall of Chinese</title>
    <script src="//cdn.jsdelivr.net/npm/phaser@3.55.2/dist/phaser.js"></script>
    <!-- <script type="module" src="src/idioms.js"></script> -->

     <!-- Booststrap (CSS) assets -->
     <link href="https://cdn.jsdelivr.net/npm/bootstrap@5.2.2/dist/css/bootstrap.min.css" rel="stylesheet" integrity="sha384-Zenh87qX5JnK2Jl0vWa8Ck2rdkQ2Bzep5IDxbcnCeuOxjzrPF/et3URy9Bv1WTRi" crossorigin="anonymous">
     <script src="https://cdn.jsdelivr.net/npm/bootstrap@5.2.2/dist/js/bootstrap.bundle.min.js" integrity="sha384-OERcA2EqjJCMA+/3y+gxIOqMEjwtxJY7qPCqsdltbNJuaOe923+mo//f6V8Qbsw3" crossorigin="anonymous"></script>
     <!-- Font Awesome (icons) assets -->
     <link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/6.2.0/css/all.min.css" integrity="sha512-xh6O/CkQoPOWDdYTDqeRdPCVd1SpvCA9XXcUnZS2FmJNp1coAFzvtCN9BmamE+4aHK8yyUHUSCcJHgXloTyT2A==" crossorigin="anonymous" referrerpolicy="no-referrer" />
</head>
<body>
    <nav class="navbar navbar-expand-lg navbar-dark bg-dark">
        <button class="navbar-toggler" type="button" data-toggle="collapse" data-target="#navbarNavAltMarkup" aria-controls="navbarNavAltMarkup" aria-expanded="false" aria-label="Toggle navigation">
          <span class="navbar-toggler-icon"></span>
        </button>
        <div class="collapse navbar-collapse" id="navbarNavAltMarkup">
          <div class="navbar-nav" id="teacherNavBar">
            <a class="nav-item nav-link my-0" href='world_selection.html'>Change World</a>
            <a class="nav-item nav-link my-0" href='#' data-bs-toggle="modal" data-bs-target="#createCustomLevel-modal">Create custom level</a>
            <a class="nav-item nav-link my-0" href='#' data-bs-toggle="modal" data-bs-target="#viewCustomLevel-modal">View custom level</a>
            <a class="nav-item nav-link my-0" href="#" data-bs-toggle="modal" data-bs-target="#viewAssignment-modal">Assignments</a>
            <a class="nav-item nav-link my-0" href="#" data-bs-toggle="modal" data-bs-target="#leaderboard-modal">Leaderboard</a>
          </div>
        </div>
          <form class="form-inline">
              <button id="teacherLogOut" class="btn btn-danger mx-2" type="button" data-bs-toggle="modal" data-bs-target="#logout-modal">Log out</button>
          </form>
      </nav>
    <div id="idiomWorld"></div>

    <!--Create custom level Modal starts here-->
    <div class="modal fade" id="createCustomLevel-modal" data-bs-backdrop="static" data-bs-keyboard="false" tabindex="-1" aria-labelledby="modal-title" aria-hidden="true">
      <div class="modal-dialog modal-dialog-centered modal-lg">
        <div class="modal-content">
          <div class="modal-header justify-content-center">
            <h4 class="modal-title" id="modal-title">Create custom level</h4>
          </div>
          <div class="modal-body">
            <div class="container">
              <div class="row text-center">
                <div class="col auto">
                  <select type="text" name="questionType" class="form-control my-3" >
                    <option value="" selected disabled>Question 1</option>
                    <option value="Idoims">Idoims</option>
                    <option value="Hanyu Pinyin">Hanyu Pinyin</option>
                    <option value="Fill in the blanks">Fill in the blanks</option>
                  </select>
                  <select type="text" name="questionType" class="form-control my-3" >
                    <option value="" selected disabled>Question 2</option>
                    <option value="Idoims">Idoims</option>
                    <option value="Hanyu Pinyin">Hanyu Pinyin</option>
                    <option value="Fill in the blanks">Fill in the blanks</option>
                  </select>
                  <select type="text" name="questionType" class="form-control my-3" >
                    <option value="" selected disabled>Question 3</option>
                    <option value="Idoims">Idoims</option>
                    <option value="Hanyu Pinyin">Hanyu Pinyin</option>
                    <option value="Fill in the blanks">Fill in the blanks</option>
                  </select>
                  <select type="text" name="questionType" class="form-control my-3" >
                    <option value="" selected disabled>Question 4</option>
                    <option value="Idoims">Idoims</option>
                    <option value="Hanyu Pinyin">Hanyu Pinyin</option>
                    <option value="Fill in the blanks">Fill in the blanks</option>
                  </select>
                  <select type="text" name="questionType" class="form-control my-3" >
                    <option value="" selected disabled>Question 5</option>
                    <option value="Idoims">Idoims</option>
                    <option value="Hanyu Pinyin">Hanyu Pinyin</option>
                    <option value="Fill in the blanks">Fill in the blanks</option>
                  </select>
                </div>
                <div class="col auto">
                  <select type="text" name="difficulty" class="form-control my-3" >
                    <option value="" selected disabled>Select difficulty</option>
                    <option value="Easy">Easy</option>
                    <option value="Medium">Medium</option>
                    <option value="Difficult">Difficult</option>
                  </select>
                  <select type="text" name="difficulty" class="form-control my-3" >
                    <option value="" selected disabled>Select difficulty</option>
                    <option value="Easy">Easy</option>
                    <option value="Medium">Medium</option>
                    <option value="Difficult">Difficult</option>
                  </select>
                  <select type="text" name="difficulty" class="form-control my-3" >
                    <option value="" selected disabled>Select difficulty</option>
                    <option value="Easy">Easy</option>
                    <option value="Medium">Medium</option>
                    <option value="Difficult">Difficult</option>
                  </select>
                  <select type="text" name="difficulty" class="form-control my-3" >
                    <option value="" selected disabled>Select difficulty</option>
                    <option value="Easy">Easy</option>
                    <option value="Medium">Medium</option>
                    <option value="Difficult">Difficult</option>
                  </select>
                  <select type="text" name="difficulty" class="form-control my-3" >
                    <option value="" selected disabled>Select difficulty</option>
                    <option value="Easy">Easy</option>
                    <option value="Medium">Medium</option>
                    <option value="Difficult">Difficult</option>
                  </select>
                </div>
              </div>
              <div class="row text-center justify-content-center mt-3">
                <div class="col-auto">
                  <input class="form-control" type="text" id="customLevelName" placeholder="Custom level name" aria-label="Search">
                </div>
                <div class="col-auto">
                  <button onclick="saveCustomLevel()" class="btn btn-success" type="submit" id="saveCustomLevelBtn">Save Custom level</button>
                </div>
              </div>
            </div>
            <div id="response"></div>
          </div>
          <div class="modal-footer justify-content-center">
            <button type="button" class="btn btn-secondary" data-bs-dismiss="modal">Close</button>
          </div>
        </div>
      </div>
    </div>
    <!--Create custom level Modal ends here-->

    <!--View custom level Modal starts here-->
    <div class="modal fade" id="viewCustomLevel-modal" tabindex="-1" aria-labelledby="modal-title" aria-hidden="true">
      <div class="modal-dialog modal-dialog-centered modal-lg">
        <div class="modal-content">
          <div class="modal-header justify-content-center">
            <h4 class="modal-title" id="modal-title">View custom levels</h4>
          </div>
          <div class="modal-body">
            <div class="container">
              <table class="table table-bordered table-light">
                <thead>
                  <tr>
                    <th scope="col">Level name</th>
                    <th scope="col">Actions</th>
                  </tr>
                </thead>
                <tbody id="viewCustomLevel">
                </tbody>
              </table>
            </div>
            <div id="response"></div>
          </div>
          <div class="modal-footer justify-content-center">
            <button type="button" class="btn btn-secondary" data-bs-dismiss="modal">Close</button>
          </div>
        </div>
      </div>
    </div>
    <!--View custom level Modal ends here-->

    <!--View assignment Modal starts here-->
    <div class="modal fade" id="viewAssignment-modal" tabindex="-1" aria-labelledby="modal-title" aria-hidden="true">
      <div class="modal-dialog modal-dialog-centered modal-lg">
        <div class="modal-content">
          <div class="modal-header justify-content-center">
            <h4 class="modal-title" id="modal-title">Assignments</h4>
          </div>
          <div class="modal-body">
            <div class="container">
              <table class="table table-bordered table-light">
                <thead>
                  <tr>
                    <th scope="col">Assignments</th>
                    <th scope="col">Due date</th>
                    <th scope="col">Actions</th>
                  </tr>
                </thead>
                <tbody id="viewAssignments"></tbody>
              </table>
            </div>
          </div>
          <div class="modal-footer justify-content-center">
            <button type="button" class="btn btn-secondary" data-bs-dismiss="modal">Close</button>
          </div>
        </div>
      </div>
    </div>
    <!--View assignment Modal ends here-->

    <!--Assignment mode Modal starts here-->
    <div class="modal fade" id="assignmentMode-modal" data-bs-backdrop="static" data-bs-keyboard="false" tabindex="-1" aria-labelledby="modal-title" aria-hidden="true">
        <div class="modal-dialog modal-fullscreen">
          <div class="modal-content">
            <div class="modal-body">
              <div class="container">
                <h1 class="text-center">Assignment</h1>
                <div class="row justify-content-center">
                  <div class="col-2" style="margin-top: 20%;" id="characterAvatarAssignment">
                    <!--<img class = "img-responsive" width = "100%"  src="images/wizard.png"/>-->
                  </div>
                  <div class="col-10" style="margin-top: 5%;">
                    <div class="row">
                      <div class="col-2">
                        <p class="fs-4 text-center">Progress:</p>
                      </div>
                      <div class="col-8" style="margin-top: 1%;" >
                        <div class="progress">
                          <div class="progress-bar" style="width: 50%;">50%</div> <!--width to update progress bar, inner html to update label -->
                        </div>
                      </div>
                    </div>
                    <div class="row">
                      <div class="col-2">
                        <p class="fs-4 text-center">Score:</p>
                      </div>
                      <div class="col-8">
                        <p class="fs-4 text-left">0/0</p>
                      </div>
                    </div>
                    <div class="row">
                      <div class="col">
                        <div class="card">
                          <h5 class="card-header text-center">Question 1</h5> <!--question number-->
                          <div class="card-body">
                            <p class="card-text">This is a sample question</p>
                          </div>
                        </div>
                      </div>
                    </div>
                    <div class="row mt-5 text-center">
                      <div class="d-grid gap-2 col-6 mx-auto">
                        <button type="button" class="btn btn-primary">1) This is Option 1</button>
                      </div>
                      <div class="d-grid gap-2 col-6 mx-auto">
                        <button type="button" class="btn btn-primary">2) This is Option 2</button>
                      </div>
                    </div>
                    <div class="row mt-3 text-center">
                      <div class="d-grid gap-2 col-6 mx-auto">
                        <button type="button" class="btn btn-primary">3) This is Option 3</button>
                      </div>
                      <div class="d-grid gap-2 col-6 mx-auto">
                        <button type="button" class="btn btn-primary">4) This is Option 4</button>
                      </div>
                    </div>
                    <div class="row mt-5">
                      <div class="col">
                        <div class="alert alert-success" role="alert">
                          <h4 class="alert-heading">Correct!</h4>
                          <p>The answer is 1</p>
                          <hr>
                          <p class="mb-0">This is the explanation for the question</p>
                        </div>
                        <div class="alert alert-danger" role="alert">
                          <h4 class="alert-heading">Wrong!</h4>
                          <p>The answer is 3</p>
                          <hr>
                          <p class="mb-0">This is the explanation for the question</p>
                        </div>
                      </div>
                    </div>
                    <div class="row mt-3">
                       <div class="col text-center">
                         <button type="button" class="btn btn-success">next question</button>
                       </div>
                    </div>
                  </div>
                </div>
              </div>
            </div>
            <div class="modal-footer justify-content-center">
              <button type="button" class="btn btn-secondary" data-bs-dismiss="modal">Close</button>
            </div>
          </div>
        </div>
    </div>
    <!--Assignment mode Modal ends here-->

    <!--Leaderboard Modal starts here-->
    <div class="modal fade" id="leaderboard-modal" tabindex="-1" aria-labelledby="modal-title" aria-hidden="true">
    <div class="modal-dialog modal-dialog-centered modal-lg">
      <div class="modal-content">
        <div class="modal-header justify-content-center">
          <h3 class="modal-title" id="modal-title">Leaderboard</h3>
        </div>
        <div class="modal-body">
          <div class="container text-left">
            <h4>Adventure mode</h4>
            <table class="table table-bordered table-light">
              <thead>
                <tr>
                  <th scope="col">Position</th>
                  <th scope="col">Name</th>
                  <th scope="col">Accuracy</th>
                </tr>
              </thead>
              <tbody id="adventureModeLeaderBoard">
              </tbody>
            </table>
          </div>
          <div class="container mt-5 text-left">
            <h4>PVP mode</h4>
            <table class="table table-bordered table-light">
              <thead>
                <tr>
                  <th scope="col">Position</th>
                  <th scope="col">Name</th>
                  <th scope="col">Rank</th>
                  <th scope="col">Rank Points</th>
                </tr>
              </thead>
              <tbody id="pvpModeLeaderBoard">
              </tbody>
            </table>
          </div>
        </div>
        <div class="modal-footer justify-content-center">
          <button type="button" class="btn btn-secondary" data-bs-dismiss="modal">Close</button>
        </div>
      </div>
    </div>
    </div>
    <!--Leaderboard Modal ends here-->

    <!--Confirm Adventure mode Modal starts here-->
    <div class="modal fade" id="startAdventureMode-modal" tabindex="-1" aria-labelledby="modal-title" aria-hidden="true">
        <div class="modal-dialog modal-dialog-centered">
          <div class="modal-content">
            <div class="modal-body text-center">
              <h5>Select adventure section</h5>
              <button onclick="selectAdventureSection(event)" type="button" class="btn btn-primary" data-bs-toggle="modal" data-bs-dismiss="modal">Lower primary</button>
              <button onclick="selectAdventureSection(event)" type="button" class="btn btn-primary" data-bs-toggle="modal" data-bs-dismiss="modal">Upper primary</button>
            </div>
            <div class="modal-footer justify-content-center">
              <button type="button" class="btn btn-secondary" data-bs-dismiss="modal">Close</button>
            </div>
          </div>
        </div>
    </div>
    <!--Confirm Adventure mode Modal ends here--> 

    <!--Adventure mode Modal starts here-->
    <div class="modal fade" id="adventureMode-modal" data-bs-backdrop="static" data-bs-keyboard="false" tabindex="-1" aria-labelledby="modal-title" aria-hidden="true">
        <div class="modal-dialog modal-fullscreen">
          <div class="modal-content">
            <div class="modal-body">
              <div class="container">
                <h1 class="text-center">Idioms' adventure</h1>
                <div class="row justify-content-center">
                  <div class="col-2" style="margin-top: 20%;" id="characterAvatarAdventure">
                    <!--<img class = "img-responsive" width = "100%"  src="images/wizard.png"/>-->
                  </div>
                  <div class="col-10" style="margin-top: 5%;">
                    <div class="row">
                      <div class="col-2">
                        <p class="fs-4 text-center">Progress:</p>
                      </div>
                      <div class="col-8" style="margin-top: 1%;" >
                        <div class="progress">
                          <div id="adventureModeProgressBar" class="progress-bar" style="width: 0%;">0%</div> <!--width to update progress bar, inner html to update label, start at 0% -->
                        </div>
                      </div>
                    </div>
                    <div class="row">
                      <div class="col-2">
                        <p class="fs-4 text-center">Score:</p>
                      </div>
                      <div class="col-8">
                        <p id="adventureModeScore" class="fs-4 text-left">0/0</p>
                      </div>
                    </div>
                    <div class="row">
                      <div class="col">
                        <div class="card">
                          <h5 id="adventureModeQuestionNo" class="card-header text-center">Question 1</h5> <!--question number-->
                          <div class="card-body">
                            <p id="adventureModeQuestion" class="card-text text-center">This is a sample question</p>
                          </div>
                        </div>
                      </div>
                    </div>
                    <div class="row mt-5 text-center">
                      <div class="d-grid gap-2 col-6 mx-auto">
                        <button id="adventureModeOption1" onclick="adventureModeSubmit(event)" type="button" value="1" class="btn btn-primary">This is Option 1</button>
                      </div>
                      <div class="d-grid gap-2 col-6 mx-auto">
                        <button id="adventureModeOption2" onclick="adventureModeSubmit(event)" type="button" value="2" class="btn btn-primary">This is Option 2</button>
                      </div>
                    </div>
                    <div class="row mt-3 text-center">
                      <div class="d-grid gap-2 col-6 mx-auto">
                        <button id="adventureModeOption3" onclick="adventureModeSubmit(event)" type="button" value="3" class="btn btn-primary">This is Option 3</button>
                      </div>
                      <div class="d-grid gap-2 col-6 mx-auto">
                        <button id="adventureModeOption4" onclick="adventureModeSubmit(event)" type="button" value="4" class="btn btn-primary">This is Option 4</button>
                      </div>
                    </div>
                    <div class="row mt-5">
                      <div id="adventureModeExplanation" class="col">
                      </div>
                    </div>
                    <div class="row mt-3">
                       <div class="col text-center">
                         <button type="button" onclick="adventureModeLoadNextQuestion()" class="btn btn-success invisible" id="adventureModeNextQuestion">next question</button> <!--invisible at the start, visible when user submits an answer, loads next question onto the modal-->
                       </div>
                    </div>
                  </div>
                </div>
              </div>
            </div>
            <div class="modal-footer justify-content-center">
              <button type="button" class="btn btn-secondary" data-bs-dismiss="modal">Exit adventure mode</button>
            </div>
          </div>
        </div>
    </div>
    <!--Adventure mode Modal ends here-->

    <!--Logout Modal starts here-->
    <div class="modal fade" id="logout-modal" tabindex="-1" aria-labelledby="modal-title" aria-hidden="true">
        <div class="modal-dialog">
          <div class="modal-content">
            <div class="modal-header">
              <h5 class="modal-title" id="modal-title">Log Out</h5>
            </div>
            <div class="modal-body">
              <p>Are you sure you want to log out?</p>
            </div>
            <div class="modal-footer">
              <button type="button" class="btn btn-secondary" data-bs-dismiss="modal">Close</button>
              <a href="../scripts/function_logout" type="button" class="btn btn-danger" id="logout">Log out</a>
            </div>
          </div>
        </div>
    </div>
    <!--Logout Modal ends here--> 

    <script type="module" src="src/idioms.js"></script>
</body>
<script>
  // global variables
  var characterID; // character ID
  var characterUserName; // character username

  var selectedAdventureSection; // the section selected by user to attempt adventure mode in: lower pri/upper pri
  var adventureModeProgress; // progress in terms of percentage, starts at 0%
  var adventureModeQnCorrect; // num of questions correct, starts at 0
  var adventureModeQnAttempted; // num of questions attempted, starts at 0
  var adventureModeCurrentQn; // current question number, starts at 1

  var assignmentToAttempt; // details of assignment to display on the modal

  function getLoggedInCharacter() {
    return new Promise(function(resolve) {
        var xmlhttp = new XMLHttpRequest();
        xmlhttp.onreadystatechange = function() {
            if (this.readyState == 4 && this.status == 200) {
                console.log("response" + this.responseText);
                resolve(this.responseText);
            }
        };
        xmlhttp.open("GET", "../scripts/functions_utility?func=Character");
        xmlhttp.send();
    })
  }

  async function getCharacterID(){
    console.log('calling backend script')
    const getcharacterID = await getLoggedInCharacter();
    characterID = getcharacterID;
    console.log(characterID);
 
  }

  function getLoggedInUsername() {
    return new Promise(function(resolve) {
        var xmlhttp = new XMLHttpRequest();
        xmlhttp.onreadystatechange = function() {
            if (this.readyState == 4 && this.status == 200) {
                resolve(this.responseText);
            }
        };
        xmlhttp.open("GET", "../scripts/functions_utility?func=Username");
        xmlhttp.send();
    })
  }

  async function getCharacterName(){
    console.log('calling backend script')
    const getcharacterUsername = await getLoggedInUsername();
    characterUserName = getcharacterUsername;
    console.log(characterUserName);
 
  }

  getCharacterID(); // call function to get characterID
  getCharacterName(); // call function to get character username

  // leaderboard
  let leaderBoardModal = document.getElementById('leaderboard-modal');
	leaderBoardModal.addEventListener('show.bs.modal', function (event){
		var adventureMode = document.getElementById('adventureModeLeaderBoard'); // Table body for adventure mode leaderboard
    var pvpMode = document.getElementById('pvpModeLeaderBoard');  // Table body for pvp mode leaderboard
    
    var rowAdventure = "";
    var rowPvp = "";
    //link backend here to get leaderboard details
    var xmlhttp = new XMLHttpRequest();
      xmlhttp.onreadystatechange = function(){
            if (this.readyState == 4 && this.status == 200){
                // the viewLeaderBoard has three possible output 1,2 and string (Adventure&PVP)
                //1 represents account_id cannot be found, 2 represents server error
                
                if (this.responseText.length > 1){
                    
                    // This is an example of the string of information for Adventure/PVP leaderboard
                    // 1,Kelvin,85.0000|2,Kelly,67.5000|3,kyrin,55.7143*1,kyrin,Bling Bling,1000|2,Kelvin,Bronze,50|3,Kelly,Bronze,50
                    
                    // We then split the string into an array
                    // WE use (*) to spit the leaderboard to Adventure and PVP
                    // leaderBoardArray[0] represents Adventure LeaderBoard
                    // leaderBoardArray[1] represents PVP LeaderBoard
                    leaderBoardArray = this.responseText.split("*");
                    adventureLeaderBoard = leaderBoardArray[0];
                    pvpLeaderBoard = leaderBoardArray[1];
                    
                    // Printing Adventure on the HTML
                    // Example of adventureLeaderBoard string
                    // 1,Kelvin,85.0000|2,Kelly,67.5000|3,kyrin,55.7143
                    
                    // We use (|) to split the individual's information
                    // Therefore, you can see that each element of the array is a player's info
                    // Example of adventureLeaderBoardArray
                    // ['1,Kelvin,85.0000', '2,Kelly,67.5000', '3,kyrin,55.7143']
                    adventureLeaderBoardArray = adventureLeaderBoard.split("|");
                    for(i=0;i<adventureLeaderBoardArray.length;i++){
                        rowAdventure = rowAdventure + '<tr>';
                        
                        // We use (,) to split again, to obtain respestive columns player's information
                        // [Position, Name, Accuracy]
                        // ['1', 'Kelvin', '85.0000']
                        student_info = adventureLeaderBoardArray[i].split(",");
                        
                        for(j=0;j<student_info.length;j++){
                            if (j===student_info.length-1){
                                rowAdventure += '<td>' + (Math.round(student_info[j] * 100) / 100).toFixed(2) + '%' + '</td>';
                            }
                            else {
                                rowAdventure += '<td>' + student_info[j] + '</td>';
                            }
                        }
                        rowAdventure += '</tr>';
                    }
                    adventureMode.innerHTML  = rowAdventure; //set innerhtml code
                    
                    // Printing PVP on the HTML
                    // Example of pvpLeaderBoard string
                    // 1,kyrin,Bling Bling,1000|2,Kelvin,Bronze,50|3,Kelly,Bronze,50
                    
                    // Similar to adventureMode's LeaderBoard we use 
                    // We use (|) to split the individual's information
                    // Therefore, you can see that each element of the array is a player's info
                    // Example of pvpLeaderBoardArray
                    // ['1,kyrin,Bling Bling,1000', '2,Kelvin,Bronze,50', '3,Kelly,Bronze,50\n']
                    pvpLeaderBoardArray = pvpLeaderBoard.split("|");
                    for(i=0;i<pvpLeaderBoardArray.length;i++){
                        rowPvp = rowPvp + '<tr>';
                        
                        // We use (,) to split again, to obtain respestive columns player's information
                        // [Position, Name, Rank, Rank Points]
                        // ['1', 'kyrin', 'Bling Bling', '1000']
                        student_info = pvpLeaderBoardArray[i].split(",");
                        for(j=0;j<student_info.length;j++){
                            rowPvp += '<td>' + student_info[j] + '</td>';
                        }
                        rowPvp += '</tr>';
                    }
                    pvpMode.innerHTML  = rowPvp; //set innerhtml code
                }
                if(this.responseText === 1 && this.responseText === "1"){
                    console.log("Account_id cannot be detected!");
                }
                if(this.responseText === 1 && this.responseText === "2"){
                    console.log("A server error occurred</div>");
                }
            }   
        };
        xmlhttp.open("POST", "../scripts/function_viewLeaderBoard", true);
        // Request headers required for a POST request
        xmlhttp.setRequestHeader("Content-type", "application/x-www-form-urlencoded");
        xmlhttp.send(`function_name=${"viewLeaderBoard"}`);
	})

  // Saving custom level
  function saveCustomLevel(){
    let emptyFields = false;
    let customLevelName = document.getElementById("customLevelName").value;
    
    // A string variable use to concatenate each question type and difficulty
    let question_type_difficulty = "";
    
    if(!customLevelName){
      emptyFields = true;
    }
    let allQuestions = document.querySelectorAll("[name='questionType']");
    let allDifficulty = document.querySelectorAll("[name='difficulty']");
    for(let i=0; i<allQuestions.length; i++){
      if(!allQuestions[i].value||!allDifficulty[i].value){
        emptyFields=true;
        break;
      }
      question_type_difficulty = question_type_difficulty + allQuestions[i].value + ',' + allDifficulty[i].value
      if (i+1 != allQuestions.length)
            question_type_difficulty = question_type_difficulty + '|';
    }
    if(emptyFields){
  		document.getElementById('response').innerHTML = `<div class="alert alert-danger my-2" role="alert">Please fill in all the fields!</div>`
    }else{
      var xmlhttp = new XMLHttpRequest();
      xmlhttp.onreadystatechange = function(){
            if (this.readyState == 4 && this.status == 200){
                // Do something with the response
                console.log(this.responseText);
                // the saveCustomLevel has four possible output 0,1,2,3,4
                // 0 represents success, 1 represents account_id cannot be found, 2 represents server error
                // 3 represents the length of customGameName is less than 2 letters.
                // 4 represente server error
                if(this.responseText.includes(0)){
                    document.getElementById('response').innerHTML = `<div class="alert alert-success" role="alert">CustomLevel Game created successfully!</div>`;
                    // empty all inputs
                    allQuestions.forEach(input => {
                      input.value = '';
                    });
                    allDifficulty.forEach(input => {
                      input.value = '';
                    });
                    // empty customName
                    document.getElementById("customLevelName").value = '';
                }
                if(this.responseText.includes(1)){
                    document.getElementById('response').innerHTML = `<div class="alert alert-danger" role="alert">Account_id cannot be detected!</div>`;
                }
                if(this.responseText.includes(2)){
                    document.getElementById('response').innerHTML = `<div class="alert alert-danger" role="alert">There is already an CustomGame with this name, please use a different one!</div>`;
                }
                if(this.responseText.includes(3)){
                    document.getElementById('response').innerHTML = `<div class="alert alert-danger" role="alert">Please enter the CustomGame name with at least TWO letter</div>`;
                }
                if(this.responseText.includes(4)){
                    document.getElementById('response').innerHTML = `<div class="alert alert-danger" role="alert">A server error occurred</div>`;
                }
            }   
        };
        xmlhttp.open("POST", "../scripts/student", true);
        // Request headers required for a POST request
        xmlhttp.setRequestHeader("Content-type", "application/x-www-form-urlencoded");
        xmlhttp.send(`customLevelName=${customLevelName}&question_type_difficulty=${question_type_difficulty}&function_name=${"createCustomGame"}`);
    }
  }

  // viewing custom level
  let viewCustomLevelModal = document.getElementById('viewCustomLevel-modal');
	viewCustomLevelModal.addEventListener('show.bs.modal', function (event){
    var table = document.getElementById("viewCustomLevel");
    var rowsHTML = ""; // initialise empty var to hold html of all the rows

    //link backend here to get a list of custom level names
    var xmlhttp = new XMLHttpRequest();
      xmlhttp.onreadystatechange = function(){
            if (this.readyState == 4 && this.status == 200){
                // Do something with the response
                //console.log(this.responseText);
                
                // the viewAllCustomGame has three possible output 1,2 and string (allCustomName)
                //1 represents account_id cannot be found, 2 represents server error
                
                if (typeof this.responseText === 'string' && this.responseText.length !== 0){
                    // Split the string into an array
                    customNameArray = this.responseText.split(",");
                    for(i=0;i<customNameArray.length;i++){
                        var row = '<tr><td>' + customNameArray[i] + '</td><td><button onclick="deleteCustomLevel(event)">delete</button></td></tr>';
                        rowsHTML += row; // add in html code
                    }
                    table.innerHTML = rowsHTML; //set innerhtml code
                }
                if(this.responseText === 1 && this.responseText === "1"){
                    document.getElementById('response').innerHTML = `<div class="alert alert-danger" role="alert">Account_id cannot be detected!</div>`;
                }
                if(this.responseText === 1 && this.responseText === "2"){
                    document.getElementById('response').innerHTML = `<div class="alert alert-danger" role="alert">A server error occurred</div>`;
                }
            }   
        };
        xmlhttp.open("POST", "../scripts/student", true);
        // Request headers required for a POST request
        xmlhttp.setRequestHeader("Content-type", "application/x-www-form-urlencoded");
        xmlhttp.send(`function_name=${"viewAllCustomGame"}`);
	})

  // deleting custom levels
  function deleteCustomLevel(e){
    let rowElements = e.srcElement.parentElement.parentElement; // row elements refer to both level name and actions
    let customLevelName = rowElements.firstChild.innerHTML;
    
    //console.log(customLevelName)
    // link delete custom level script here, send customLevelName
    // if successful, remove elements
    var xmlhttp = new XMLHttpRequest();
    xmlhttp.onreadystatechange = function(){
            if (this.readyState == 4 && this.status == 200){
                // Do something with the response
                console.log(this.responseText);
                
                // the deleteCustomGame has three possible output 0,1,2
                // 0 represents customGame delete success
                // 1 Account_id cannot be found, 2 represents server error
                if(this.responseText.includes(0)){
                    rowElements.remove();
                }
                if(this.responseText.includes(1)){
                    document.getElementById('response').innerHTML = `<div class="alert alert-danger" role="alert">Account_id cannot be detected!</div>`;
                }
                if(this.responseText.includes(2)){
                    document.getElementById('response').innerHTML = `<div class="alert alert-danger" role="alert">A server error occurred</div>`;
                }
            }   
        };
        xmlhttp.open("POST", "../scripts/student", true);
        // Request headers required for a POST request
        xmlhttp.setRequestHeader("Content-type", "application/x-www-form-urlencoded");
        xmlhttp.send(`customLevelName=${customLevelName}&function_name=${"deleteCustomGame"}`);
  }


  // ASSIGNMENT MODE STUFF
  // viewing assignments
  let viewAssignmentModal = document.getElementById('viewAssignment-modal');
	viewAssignmentModal.addEventListener('show.bs.modal', function (event){
    var table = document.getElementById("viewAssignments");
    var rowsHTML = ""; // initialise empty var to hold html of all the rows
    var row = '<tr><td>TEST ASSIGNMENT NAME</td><td>15/11/2022</td><td><button onclick="openAssignment(event)" class="btn btn-primary" data-bs-dismiss="modal">Attempt</button></td></tr>';
    table.innerHTML = row;

    //link backend here to get a list of custom level names
	})

  // opening assignment modal
  function openAssignment(e){
    let assignmentName = e.srcElement.parentElement.parentElement.firstChild.innerHTML;
    console.log(assignmentName);

    // get assignment based on assignmentName, then assign it to assignmentToAttempt global variable

    var assignmentModal = new bootstrap.Modal(document.getElementById('assignmentMode-modal'), {});
	  assignmentModal.show();
  }

  let assignmentModeModal = document.getElementById('assignmentMode-modal')
  // when modal opens, load the first question
  assignmentModeModal.addEventListener('show.bs.modal', function (event){
		var character = assignmentModeModal.querySelector('#characterAvatarAssignment'); 
    // Add player character based on characterID
    switch (characterID) {
    case "1":
        character.innerHTML = '<img class = "img-responsive" width = "100%"  src="images/martialHero.png"/>';
        break;
    case "2":
        character.innerHTML = '<img class = "img-responsive" width = "100%"  src="images/huntress.png"/>';
        break;
    case "3":
        character.innerHTML = '<img class = "img-responsive" width = "100%"  src="images/heroKnight.png"/>';
        break;
    case "4":
        character.innerHTML = '<img class = "img-responsive" width = "100%"  src="images/wizard.png"/>';
        break;
    default:
        console.log("Something went wrong in player creation in create()");
    }
	})




  //ADVENTURE MODE STUFF
  // function to assign section to attempt adventure in, then open adventure mode modal
  function selectAdventureSection(e){
    selectedAdventureSection = e.srcElement.innerHTML.split(" ")[0];
    console.log(selectedAdventureSection);

    // show adventure mode modal
    var adventureModal = new bootstrap.Modal(document.getElementById('adventureMode-modal'), {});
	  adventureModal.show();
    socket.send("/adventure "+selectedAdventureSection);
  }

  // get all the components in the adventure mode modal
  var adventureModeProgressBar = document.getElementById('adventureModeProgressBar');
  var adventureModeScore = document.getElementById('adventureModeScore');
  var adventureModeQuestionNo = document.getElementById('adventureModeQuestionNo');
  var adventureModeQuestion = document.getElementById('adventureModeQuestion');
  var adventureModeOption1 = document.getElementById('adventureModeOption1');
  var adventureModeOption2 = document.getElementById('adventureModeOption2');
  var adventureModeOption3 = document.getElementById('adventureModeOption3');
  var adventureModeOption4 = document.getElementById('adventureModeOption4');
  var adventureModeExplanation = document.getElementById('adventureModeExplanation');
  var adventureModeNextQuestionBtn = document.getElementById('adventureModeNextQuestion');

  // function for option buttons to submit answer
  function adventureModeSubmit(e){
      // check if submitted answer is correct/wrong
      // then update progressBar, score, explanation accordingly
      // if the current question is not the last question, make nextQuestionBtn visible
      // disable all option buttons after submitting

      var selectedAnswer = e.srcElement.value; //selected answer
      console.log(selectedAnswer);

      socket.send("/answer "+selectedAnswer);

      //disabling all option buttons
      adventureModeOption1.disabled = true;
      adventureModeOption2.disabled = true;
      adventureModeOption3.disabled = true;
      adventureModeOption4.disabled = true;

      adventureModeProgress += 10;
      adventureModeProgressBar.innerHTML = adventureModeProgress + "%"; // update label of progress bar
      adventureModeProgressBar.style.width = adventureModeProgress + "%"; // update width of progress bar

      if(adventureModeProgress < 100){
        adventureModeNextQuestionBtn.className = "btn btn-success"; // make next question btn visible if progress is not 100
      }

      // adventureModeQnAttempted += 1
      // adventureModeQnCorrect += 1
      // adventureModeScore.innerHTML = adventureModeQnCorrect + "/" + adventureModeQnAttempted;

      // template for explanation
      // <div class="alert alert-success" role="alert">
      //   <h4 class="alert-heading">Correct!</h4>
      //   <p>The answer is 1</p>
      //   <hr>
      //   <p class="mb-0">This is the explanation for the question</p>
      // </div>
      // <div class="alert alert-danger" role="alert">
      //   <h4 class="alert-heading">Wrong!</h4>
      //   <p>The answer is 3</p>
      //   <hr>
      //   <p class="mb-0">This is the explanation for the question</p>
      // </div>

      // adventureModeExplanation.innerHTML = `<div class="alert alert-success" role="alert">
      //                                       <h4 class="alert-heading">Correct!</h4>
      //                                       <p>The answer is 1</p>
      //                                       <hr>
      //                                       <p class="mb-0">This is the explanation for the question</p>
      //                                     </div>
      //                                    `;      
  }
  var questionQueue;
  // function to update modal upon clicking on next button
  function adventureModeLoadNextQuestion(){
    return new Promise(function(resolve) {
        // update questionNo, question, option1, option2, option3, option4
        // make explanation empty
        // make nextQuestionBtn invisible
        // reenable all option buttons so they can answer new question

        // update current question label
        adventureModeCurrentQn += 1;
        adventureModeQuestionNo.innerHTML = "Question " + adventureModeCurrentQn;

        // make next question btn invisible
        adventureModeNextQuestionBtn.className = "btn btn-success invisible";

        // reenabling all option buttons
        adventureModeOption1.disabled = false;
        adventureModeOption2.disabled = false;
        adventureModeOption3.disabled = false;
        adventureModeOption4.disabled = false;

        adventureModeExplanation.innerHTML = ""; // empty the explanation

        console.log("loading next question")

        if(questionQueue) {
          adventureModeQuestion.innerHTML = questionQueue[0];
          for(let i=1; i<=4; i++) {
              document.getElementById('adventureModeOption'+i).innerHTML = questionQueue[i];
          }
        }
    });
  }
  let adventureModeModal = document.getElementById('adventureMode-modal');
  adventureModeModal.addEventListener('show.bs.modal', async function (event){
    // set starting values
    adventureModeProgress = 0; // progress in terms of percentage, starts at 0
    adventureModeQnCorrect = 0; // num of questions correct, starts at 0
    adventureModeQnAttempted = 0; // num of questions attempted, starts at 0
    adventureModeCurrentQn = 0; // current question number, starts at 1

    adventureModeNextQuestionBtn.className = "btn btn-success invisible"; // make next question btn invisible
    adventureModeExplanation.innerHTML = ""; // make explanation blank
    adventureModeProgressBar.innerHTML = "0%"; // set label of progress bar to 0%
    adventureModeProgressBar.style.width = "0%"; // set width of progress bar to 0%
    adventureModeScore.innerHTML = "0/0" // set score to 0
    adventureModeQuestionNo.innerHTML = "Question 1" // set question number to 1

    // when modal opens, get adventure based on selectedAdventureSection: lower pri/upper pri
    // console.log(selectedAdventureSection);

    // Add player character based on characterID
    var character = adventureModeModal.querySelector('#characterAvatarAdventure'); 
    switch (characterID) {
    case "1":
        character.innerHTML = '<img class = "img-responsive" width = "100%"  src="images/martialHero.png"/>';
        break;
    case "2":
        character.innerHTML = '<img class = "img-responsive" width = "100%"  src="images/huntress.png"/>';
        break;
    case "3":
        character.innerHTML = '<img class = "img-responsive" width = "100%"  src="images/heroKnight.png"/>';
        break;
    case "4":
        character.innerHTML = '<img class = "img-responsive" width = "100%"  src="images/wizard.png"/>';
        break;
    default:
        console.log("Something went wrong in player creation in create()");
    }
      // load first question here
      await adventureModeLoadNextQuestion();
    })
</script>
<script>
  var socket;
  var spawn; 
  var moving;
  var destroy;
</script>
<script type="module" src="../websocket/socket.js"></script>
</html>